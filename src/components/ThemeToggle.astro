---
import { Icon } from 'astro-icon/components'
import { cn } from '~/components/ui/cn'

interface Props {
  class?: string
}

const { class: className } = Astro.props as Props
---

<button
  id="theme-toggle"
  class={cn('relative size-7 text-lighter hocus:text-strong transition-colors flex items-center translate-z-0 touch-manipulation focus-visible:focus-ring rounded-full', className)}
  aria-label="Toggle theme"
  title="Toggle dark/light mode"
  type="button"
>
  <Icon aria-hidden="true" name="akar-icons:sun" class="size-5 absolute inset-1 opacity-100 dark:opacity-0 transition-opacity" />
  <Icon aria-hidden="true" name="akar-icons:moon" class="size-5 absolute inset-1 opacity-0 dark:opacity-100 transition-opacity" />
</button>

<script>
  const themeToggle = document.getElementById('theme-toggle')

  themeToggle?.addEventListener('click', toggleTheme)

  function toggleTheme() {
    const html = document.documentElement
    const metaTag = document.querySelector('meta[name="theme-color"]')!
    if (html.classList.contains('dark')) {
      html.classList.remove('dark')
      localStorage.setItem('theme', 'light')
      metaTag.setAttribute('content', '#FAFAFA')
    } else {
      html.classList.add('dark')
      localStorage.setItem('theme', 'dark')
      metaTag.setAttribute('content', '#0A0A0A')
    }
  }
</script>
