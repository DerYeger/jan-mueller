---
import type { PhotoData } from '~/components/showcase/Photo.astro';
import Photo from '~/components/showcase/Photo.astro'
import Showcase from '~/components/showcase/Showcase.astro'

const photos: PhotoData[] = [
  {
    src: import('~/assets/photos/rauris.png'),
    alt: (location) => `A green forest in ${location}.`,
    location: 'Rauris, Austria',
  },
  {
    src: import('~/assets/photos/binz.png'),
    alt: (location) => `Beach and dunes in ${location}.`,
    location: 'Binz, Germany',
  },
  {
    src: import('~/assets/photos/semmering.png'),
    alt: (location) => `Mountainous landscape near ${location}.`,
    location: 'Semmering, Austria',
  },
  {
    src: import('~/assets/photos/doernberg.png'),
    alt: (location) => `A single tree on a hill near ${location}.`,
    location: 'DÃ¶rnberg, Germany',
  },
]
---

<Showcase
  name="Photos"
  class="photos h-0 border-0 !bg-transparent !p-0 !pb-[100%]"
>
  {
    photos.map((photo, index) => (
      <Photo photo={photo} initial={index === 0} index={index} total={photos.length} />
    ))
  }
</Showcase>

<script>
  ;[...document.getElementsByClassName('photos')].forEach((container) => {
    const images = container.getElementsByClassName('photo')
    const length = images.length
    let timeout: number | undefined
    let current = 0

    const dots = [...container.getElementsByClassName('dot')] as HTMLElement[]
    dots.forEach((dot) => {
      dot.addEventListener('click', () => {
        const index = dot.dataset.index
        if (!index) {
          return
        }
       showImage(parseInt(index, 10))
      })
    })

    container.addEventListener('pointerenter', clearQueuedImage)
    container.addEventListener('pointerleave', queueNextImage)

    queueNextImage()

    function clearQueuedImage() {
      if (!timeout) {
        return
      }
      window.clearTimeout(timeout)
      timeout = undefined
    }

    function queueNextImage() {
      clearQueuedImage()
      timeout = window.setTimeout(() => {
        showImage((current + 1) % length)
        queueNextImage()
      }, 5000)
    }

    function showImage(index: number) {
      if (index === current) {
        return
      }
      toggleImage(current)
      toggleImage(index)
      current = index
    }

    function toggleImage(index: number) {
      images[index].classList.toggle('opacity-0')
      images[index].classList.toggle('z-10')
    }
  })
</script>
