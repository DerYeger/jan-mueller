---
import { Image } from '@astrojs/image/components'

import DateComponent from '../components/date/DateComponent.astro'
import MainLayout from '../layouts/MainLayout.astro'
import { getImageAsset } from '../lib'

// Use Astro.glob() to fetch all posts, and then sort them by date.
const posts = (await Astro.glob('./blog/*.{md,mdx}')).sort(
  (a, b) =>
    new Date(b.frontmatter.publishDate).valueOf() -
    new Date(a.frontmatter.publishDate).valueOf()
)

const assets = await Astro.glob('../assets/**/*')
---

<MainLayout title="Blog — Jan Müller">
  <content>
    <div class="prose dark:prose-invert mb-8">
      <h1>Jan's Blog</h1>
    </div>
    <ul class="grid gap-4 grid-cols-1 sm:grid-cols-2">
      {
        posts.map((post) => (
          <li class="card card-hover overflow-hidden">
            <a href={post.url} rel="prefetch" class="block no-underline">
              {post.frontmatter.heroImage && (
                <Image
                  class="w-full"
                  src={
                    getImageAsset(assets, post.frontmatter.heroImage)?.default
                  }
                  height={200}
                  width={600}
                  quality={100}
                  format="webp"
                />
              )}
              <div class="prose prose-sm dark:prose-invert p-4 flex flex-col gap-2">
                <h2 class="mt-0">{post.frontmatter.title}</h2>
                <span class="text-lighter">
                  <DateComponent
                    date={post.frontmatter.publishDate}
                    format="MMM DD, YYYY"
                  />
                </span>
                <span class="text-light">{post.frontmatter.description}</span>
              </div>
            </a>
          </li>
        ))
      }
    </ul>
  </content>
</MainLayout>
